{
  "basic_webhook": {
    "success": true,
    "duration": 8.729038000106812,
    "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.12.11, pytest-8.4.2, pluggy-1.6.0 -- /openhands/poetry/openhands-ai-5O4_aCHf-py3.12/bin/python\ncachedir: .pytest_cache\nmetadata: {'Python': '3.12.11', 'Platform': 'Linux-6.11.11-linuxkit-aarch64-with-glibc2.41', 'Packages': {'pytest': '8.4.2', 'pluggy': '1.6.0'}, 'Plugins': {'anyio': '4.9.0', 'json-report': '1.5.0', 'forked': '1.6.0', 'cov': '7.0.0', 'asyncio': '1.3.0', 'timeout': '2.4.0', 'metadata': '3.1.1', 'playwright': '0.7.1', 'base-url': '2.1.0', 'libtmux': '0.47.0', 'xdist': '3.8.0'}, 'Base URL': ''}\nrootdir: /workspace/openhands\nconfigfile: pytest.ini\nplugins: anyio-4.9.0, json-report-1.5.0, forked-1.6.0, cov-7.0.0, asyncio-1.3.0, timeout-2.4.0, metadata-3.1.1, playwright-0.7.1, base-url-2.1.0, libtmux-0.47.0, xdist-3.8.0\nasyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function\ncollecting ... collected 13 items\n\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_init_with_default_client PASSED [  7%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_init_with_custom_client PASSED [ 15%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_write_triggers_webhook PASSED [ 23%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_write_with_bytes_content PASSED [ 30%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_delete_triggers_webhook PASSED [ 38%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_read_delegates_to_underlying_store PASSED [ 46%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_list_delegates_to_underlying_store PASSED [ 53%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_webhook_retry_on_failure PASSED [ 61%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_webhook_failure_after_retries PASSED [ 69%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_multiple_operations_trigger_multiple_webhooks PASSED [ 76%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_webhook_url_construction PASSED [ 84%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_empty_path_handling PASSED [ 92%]\ntests/unit/storage/test_web_hook.py::TestWebHookFileStore::test_special_characters_in_path PASSED [100%]\n\n--------------------------------- JSON report ----------------------------------\nreport saved to: test_results.json\n============================== 13 passed in 8.08s ==============================\n",
    "stderr": "",
    "test_count": 13,
    "passed": 13,
    "failed": 0,
    "skipped": 0,
    "coverage": {}
  },
  "batched_webhook": {
    "success": false,
    "duration": 5.7996721267700195,
    "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.12.11, pytest-8.4.2, pluggy-1.6.0 -- /openhands/poetry/openhands-ai-5O4_aCHf-py3.12/bin/python\ncachedir: .pytest_cache\nmetadata: {'Python': '3.12.11', 'Platform': 'Linux-6.11.11-linuxkit-aarch64-with-glibc2.41', 'Packages': {'pytest': '8.4.2', 'pluggy': '1.6.0'}, 'Plugins': {'anyio': '4.9.0', 'json-report': '1.5.0', 'forked': '1.6.0', 'cov': '7.0.0', 'asyncio': '1.3.0', 'timeout': '2.4.0', 'metadata': '3.1.1', 'playwright': '0.7.1', 'base-url': '2.1.0', 'libtmux': '0.47.0', 'xdist': '3.8.0'}, 'Base URL': ''}\nrootdir: /workspace/openhands\nconfigfile: pytest.ini\nplugins: anyio-4.9.0, json-report-1.5.0, forked-1.6.0, cov-7.0.0, asyncio-1.3.0, timeout-2.4.0, metadata-3.1.1, playwright-0.7.1, base-url-2.1.0, libtmux-0.47.0, xdist-3.8.0\nasyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function\ncollecting ... collected 17 items\n\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_write_operation_batched PASSED [  5%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_delete_operation_batched PASSED [ 11%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batch_size_limit_triggers_send PASSED [ 17%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_multiple_updates_same_file PASSED [ 23%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_flush_sends_immediately PASSED [ 29%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_multiple_operations_in_single_batch PASSED [ 35%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_binary_content_handling PASSED [ 41%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_timeout_edge_cases PASSED [ 47%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_large_content_handling FAILED [ 52%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_concurrent_operations PASSED [ 58%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_error_handling PASSED [ 64%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_mixed_content_types FAILED [ 70%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_empty_batch_handling PASSED [ 76%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_url_construction PASSED [ 82%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_special_characters_in_paths PASSED [ 88%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_unicode_content PASSED [ 94%]\ntests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_performance_large_batch PASSED [100%]\n\n=================================== FAILURES ===================================\n___ TestBatchedWebHookFileStore.test_batched_webhook_large_content_handling ____\n\nself = <test_batched_web_hook.TestBatchedWebHookFileStore object at 0xffff8afe0980>\nfile_store = <test_batched_web_hook.MockFileStore object at 0xffff8b05f350>\nmock_client = <MagicMock spec='Client' id='281473014203264'>\n\n    def test_batched_webhook_large_content_handling(self, file_store, mock_client):\n        \"\"\"Test handling of content that exceeds batch size limits.\"\"\"\n        batched_store = BatchedWebHookFileStore(\n            file_store=file_store,\n            base_url='http://example.com',\n            client=mock_client,\n            batch_timeout_seconds=1.0,  # Long timeout\n            batch_size_limit_bytes=50,  # Very small limit\n        )\n    \n        # Write content that exceeds batch size\n        large_content = 'x' * 100  # 100 characters\n        batched_store.write('/large.txt', large_content)\n    \n        # Should trigger immediate batch due to size limit\n>       mock_client.post.assert_called_once()\n\ntests/unit/storage/test_batched_web_hook.py:272: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <MagicMock name='mock.post' id='281473014207680'>\n\n    def assert_called_once(self):\n        \"\"\"assert that the mock was called only once.\n        \"\"\"\n        if not self.call_count == 1:\n            msg = (\"Expected '%s' to have been called once. Called %s times.%s\"\n                   % (self._mock_name or 'mock',\n                      self.call_count,\n                      self._calls_repr()))\n>           raise AssertionError(msg)\nE           AssertionError: Expected 'post' to have been called once. Called 0 times.\n\n/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py:928: AssertionError\n_____ TestBatchedWebHookFileStore.test_batched_webhook_mixed_content_types _____\n\nself = <test_batched_web_hook.TestBatchedWebHookFileStore object at 0xffff8afe1040>\nfile_store = <test_batched_web_hook.MockFileStore object at 0xffff88ee8470>\nmock_client = <MagicMock spec='Client' id='281472979076304'>\n\n    def test_batched_webhook_mixed_content_types(self, file_store, mock_client):\n        \"\"\"Test handling of mixed text and binary content in batches.\"\"\"\n        batched_store = BatchedWebHookFileStore(\n            file_store=file_store,\n            base_url='http://example.com',\n            client=mock_client,\n            batch_timeout_seconds=0.1,\n            batch_size_limit_bytes=1000,\n        )\n    \n        # Mix of text and binary content\n        batched_store.write('/text.txt', 'Plain text content')\n        batched_store.write('/binary.bin', b'\\x00\\x01\\x02\\x03')\n        batched_store.delete('/old.txt')\n    \n        # Wait for batch processing\n        time.sleep(0.2)\n    \n        # Verify batch was sent\n        mock_client.post.assert_called_once()\n        args, kwargs = mock_client.post.call_args\n        batch_payload = kwargs['json']\n    \n        # Should have 3 operations\n        assert len(batch_payload) == 3\n    \n        # Check text content\n        text_ops = [op for op in batch_payload if op['path'] == '/text.txt']\n        assert len(text_ops) == 1\n        assert text_ops[0]['content'] == 'Plain text content'\n        assert 'encoding' not in text_ops[0]\n    \n        # Check binary content\n        binary_ops = [op for op in batch_payload if op['path'] == '/binary.bin']\n        assert len(binary_ops) == 1\n>       assert binary_ops[0]['encoding'] == 'base64'\n               ^^^^^^^^^^^^^^^^^^^^^^^^^\nE       KeyError: 'encoding'\n\ntests/unit/storage/test_batched_web_hook.py:374: KeyError\n--------------------------------- JSON report ----------------------------------\nreport saved to: test_results.json\n=========================== short test summary info ============================\nFAILED tests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_large_content_handling - AssertionError: Expected 'post' to have been called once. Called 0 times.\nFAILED tests/unit/storage/test_batched_web_hook.py::TestBatchedWebHookFileStore::test_batched_webhook_mixed_content_types - KeyError: 'encoding'\n========================= 2 failed, 15 passed in 4.29s =========================\n",
    "stderr": "--- Logging error ---\nTraceback (most recent call last):\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 480, in __call__\n    result = fn(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/workspace/openhands/openhands/storage/batched_web_hook.py\", line 260, in _send_batch_request\n    response = self.client.post(self.base_url, json=batch_payload)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1139, in __call__\n    return self._mock_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1143, in _mock_call\n    return self._execute_mock_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1198, in _execute_mock_call\n    raise effect\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 480, in __call__\n    result = fn(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/workspace/openhands/openhands/storage/batched_web_hook.py\", line 260, in _send_batch_request\n    response = self.client.post(self.base_url, json=batch_payload)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1139, in __call__\n    return self._mock_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1143, in _mock_call\n    return self._execute_mock_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1198, in _execute_mock_call\n    raise effect\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 480, in __call__\n    result = fn(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/workspace/openhands/openhands/storage/batched_web_hook.py\", line 260, in _send_batch_request\n    response = self.client.post(self.base_url, json=batch_payload)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1139, in __call__\n    return self._mock_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1143, in _mock_call\n    return self._execute_mock_call(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/unittest/mock.py\", line 1198, in _execute_mock_call\n    raise effect\nException: Network error\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/workspace/openhands/openhands/storage/batched_web_hook.py\", line 212, in _send_batch\n    self._send_batch_request(batch_to_send)\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 338, in wrapped_f\n    return copy(f, *args, **kw)\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 477, in __call__\n    do = self.iter(retry_state=retry_state)\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 378, in iter\n    result = action(retry_state)\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/lib/python3.12/site-packages/tenacity/__init__.py\", line 421, in exc_check\n    raise retry_exc from fut.exception()\ntenacity.RetryError: RetryError[<Future at 0xffff95627770 state=finished raised Exception>]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/logging/__init__.py\", line 1163, in emit\n    stream.write(msg + self.terminator)\nValueError: I/O operation on closed file.\nCall stack:\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/threading.py\", line 1032, in _bootstrap\n    self._bootstrap_inner()\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/threading.py\", line 1075, in _bootstrap_inner\n    self.run()\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/threading.py\", line 1012, in run\n    self._target(*self._args, **self._kwargs)\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/concurrent/futures/thread.py\", line 93, in _worker\n    work_item.run()\n  File \"/openhands/micromamba/envs/openhands/lib/python3.12/concurrent/futures/thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/workspace/openhands/openhands/storage/batched_web_hook.py\", line 214, in _send_batch\n    logger.exception('Error sending webhook batch')\nMessage: 'Error sending webhook batch'\nArguments: ()\n",
    "test_count": 17,
    "passed": 15,
    "failed": 2,
    "skipped": 0,
    "coverage": {}
  },
  "overall_success": false
}